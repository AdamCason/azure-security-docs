---
title: Malware Scanning in Defender for Storage - Microsoft Defender for Cloud
description: Learn about the benefits and features of malware scanning in Microsoft Defender for Storage.
ms.date: 03/16/2023
author: bmansheim
ms.author: benmansheim
ms.topic: how-to
---

# Malware Scanning in Defender for Storage

Malware Scanning in Defender for Storage helps protect your storage accounts from malicious content by performing a full malware scan on uploaded content in near real time, leveraging Microsoft Defenders Antivirus capabilities. It is designed to help fulfill security and compliance requirements to handle untrusted content.

The Malware Scanning capability is an agentless SaaS solution that allows simple setup at scale, with zero maintenance, and supports automating response at scale.

## Malware upload is a top threat on cloud storage

Content uploaded to cloud storage could be malware. Storage accounts can be a malware entry point into the organization and a malware distribution point. To protect organizations from this threat, content in cloud storage must be scanned for malware before it is accessed.

Malware Scanning in Defender for Storage helps protect storage accounts from malicious content.

- A built-in SaaS solution that allows simple enabling at scale with zero maintenance

- Comprehensive antimalware capabilities leveraging Microsoft Defender Antivirus (MDAV), catching polymorphic and metamorphic malware

- Every file type is scanned (including archives like zip files) and a result is returned for every scan. The file size limit is 2GB.

- Supports response at scale – deleting or quarantining suspicious files, based on the blobs’ index tags or Event Grid events

- When catching a malicious file, detailed Microsoft Defender for Cloud security alerts are generated

- Designed to help fulfill security and compliance requirements to scan untrusted content uploaded to storage, including an option to log every scan result.

## Common use-cases and scenarios

Some common use-cases and scenarios for Malware Scanning in Defender for Storage include:

- Protecting storage accounts from malicious content, especially when content in the storage account is uploaded from untrusted sources (customers and partners, anonymous users, etc.)

- Adhering to compliance standards that require on-upload malware scanning for non-compute resources (NIST, SWIFT, UK GOV, and more), and collecting the necessary evidence for compliance audits.

## How does Malware Scanning work?

### On-upload triggers
When a blob is uploaded to a protected storage account - a malware scan is triggered. All upload methods trigger the scan. Modifying a blob is an upload operation and therefore the modified content is scanned after the update.

### Scan regions and data retention

The blob is read by the Malware Scanning service that uses Microsoft Defender Antivirus technologies.

The malware scanning is regional, the scanned content stays within the same region. The content is not saved by the service, it is scanned "in-memory" and immediately deleted afterward.

### Latency

Scan are performed near-real time. The throughput for each storage account is 2GB/min, passing this will result in a slowdown. The scanning process and its results do not interfere with or block access to the uploaded data. The scanning has minimal impact on storage IOPS.

For every blob that is uploaded to the account, Malware Scanning adds a read operation and an index tag update operation. The limit on blob accounts is 20K transactions per second, so, depending on the workload of the application, the added operations in most cases are negligible.

### Access customer data

To scan your data, the Malware Scanning service requires access to your data. During service enablement, a new Data Scanner resource called "StorageDataScanner" is created in your Azure subscription. This resource is granted “Blob data owner” role to access and change your data for Malware Scanning and Sensitive Data Discovery.

> [!NOTE]
> To improve granularity of permissions, a built-in dedicated role will be created in a future release with these permissions:
> - "Microsoft.Storage/storageAccounts/blobServices/containers/read"
> - "Microsoft.Storage/storageAccounts/blobServices/containers/blobs/read"
> - “Microsoft.Storage/storageAccounts/blobServices/containers/blobs/tags/write”
> - “Microsoft.Storage/storageAccounts/blobServices/containers/blobs/tags/read”

## What can you do with the scan results?

### Defender for Cloud security alerts

When a malicious file is detected, Microsoft Defender for Cloud generates a Microsoft Defender for Cloud security alert. To see the alert, go to “Microsoft Defender for Cloud” security alerts blade.
The security alert contains details and context on the file, the malware type, and recommended investigation and remediation steps. To use these alerts for remediation you can:

1. View security alerts in the Azure Portal by navigating to Microsoft Defender for Cloud -> security alerts
1. Configure automations based on these alerts.
1. Export security alerts to a SIEMYou can continuously export security alerts Microsoft Sentinel (Microsoft’s SIEM) using Microsoft Sentinel connector, or another SIEM of your choice.

Learn more about [responding to security alerts](alerts-overview.md).

### Event Grid event

Event Grid is useful for event-driven automation. It is the fastest method to get results with minimum latency in a form of events that you can use for automating response.

Events from Event Grid custom topics can be consumed with multiple endpoint types.
The most useful for Malware Scanning scenarios are:

- Function App (previously called Azure Function) – use a serverless function to run code for automated response like move, delete or quarantine.
- Web Hook – to connect an application.
- Event Hub & Service Bus Queue – to notify downstream consumers.

For each scan result, an event will be sent using the below schema where the <scanResultType> field contains the scan result of the uploaded blob < blobUri >  and will be used part of your response automation logic.

Learn more about [working with Event Grid scan results](link).

### Logs Analytics

You may want to log your scan results for compliance evidence or investigating scan results. By setting up a Log Analytics Workspace destination, you can store every scan result in a centralized log repository that is easy to query. You can view the results by navigating to the Log Analytics destination workspace and looking for the `StorageAntimalwareScanResults` table.

Learn more about [setting up Log Analytics results](link).

### Cost control

Malware Scanning is billed per GB scanned. To provide cost predictability, Malware Scanning supports setting a cap on the amount of GB scanned in a single month per storage account. This setting can be set at the subscription level to apply to each storage account in the subscription, or you can set it for a specific storage account. The default value for each storage account is 5000GB per month, and after crossing this limit, blobs will not be scanned (with up to a 20GB confidence interval). Learn about how to [configure scan limits](link).

### Handling possible false positives

If you have a file that you suspect might be malware or is being incorrectly detected, you can submit it to us for analysis through [the sample submission portal](https://aka.ms/submitfile). Select “Microsoft Defender for Storage” as the source.

Malware Scanning does not block access or change permissions to the uploaded blob, even if it is malicious.

## Limitations

- Legacy v1 storage accounts are not supported
- Azure Files is not supported for Malware Scanning
- Client-side encrypted blobs are not supported (they cannot be decrypted before scan by the service). [data encrypted at rest by CMK is supported].
- File size limit is 2GB
- The “capping” mechanism is currently not functional. You can set your limitations now, and they will set in when “capping” starts working.
- Malware Scanning scan thruput rate limit per-storage-account – 2GB/min
- Uploading in a higher rate will result slow-down scan – files will be scanned later
- Index tag scan result is not supported in storage account with Hierarchical namespace enabled (Azure Data Lake Storage Gen2)
- [Append and Page blobs](/rest/api/storageservices/understanding-block-blobs--append-blobs--and-page-blobs) are not supported for Malware Scanning.

## Next steps

In this article, you learned about Microsoft Defender for Storage.

> [!div class="nextstepaction"]
> [Enable Defender for Storage](enable-enhanced-security.md)

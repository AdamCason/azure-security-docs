---
title: Manage vulnerability findings in your Azure SQL databases without a storage account using Microsoft Defender for Cloud
description: Learn how to remediate software vulnerabilities and disable findings with the express configuration on Azure SQL Database, Azure SQL Managed Instance, and Azure Synapse Analytics.
author: bmansheim
ms.author: benmansheim
ms.reviewer: wiassaf, vanto, mathoma
ms.date: 10/06/2022
ms.service: defender-for-cloud
ms.topic: how-to
ms.custom: sqldbrb=3
tags: azure-synapse
---
# Manage vulnerability findings in your Azure SQL databases without a storage account (Express)

## View scan history

Select Scan History in the vulnerability assessment pane to view a history of all scans previously run on this database. Select a particular scan in the list to view the detailed results of that scan.
Express configuration does not store scan results if they are identical to previous scans, so the history page will update only when findings’ statuses change.

## Disable specific findings from Microsoft Defender for Cloud (preview)

If you have an organizational need to ignore a finding, rather than remediate it, you can optionally disable it. Disabled findings don't impact your secure score or generate unwanted noise.

When a finding matches the criteria you've defined in your disable rules, it won't appear in the list of findings. Typical scenarios may include:

Disable findings with severity below medium

Disable findings that are non-patchable

Disable findings from benchmarks that aren't of interest for a defined scope

 Important

To disable specific findings, you need permissions to edit a policy in Azure Policy. Learn more in Azure RBAC permissions in Azure Policy.

To create a rule:

From the recommendations detail page for Vulnerability assessment findings on your SQL servers on machines should be remediated, select Disable rule.

Select the relevant scope.

Define your criteria. You can use any of the following criteria:

Finding ID

Severity

Benchmarks

Shape Create a disable rule for VA findings on SQL servers on machines

Select Apply rule. Changes might take up to 24hrs to take effect.

To view, override, or delete a rule:

Select Disable rule.

From the scope list, subscriptions with active rules show as Rule applied.

Shape Modify or delete an existing rule

To view or delete the rule, select the ellipsis menu ("...").

## Configure email notifications using Azure Logic Apps

In order to receive regular updates of your databases’ vulnerability assessment status you can use the following customizable Azure Logic Apps template:
https://github.com/Azure/Microsoft-Defender-for-Cloud/tree/main/Workflow%20automation/Notify-SQLVulnerabilityReport


Using the template will allow you to:

- Choose the timing of the email reports.
- Have a consistent view of your vulnerability assessment status that includes disabled rules.
- Send reports for Azure SQL Servers and SQL VMs.
- Customize report structure and look-and-feel to match your organizational standards.

## Manage vulnerability assessments programmatically

Express configuration is currently only supported using the latest REST API version with the following functionality:

| Description                                                   | Scope           | API                                                  |
| :------------------------------------------------------------ | :-------------- | :--------------------------------------------------- |
| Baseline bulk operations                                      | System Database | Sql Vulnerability Assessment Baselines               |
|                                                               |                 | Sql Vulnerability Assessment Baseline                |
| Baseline bulk operations                                      | User Database   | Database Sql Vulnerability Assessment Baselines      |
| Single rule baseline operations                               | User Database   | Database Sql Vulnerability Assessment Rule Baselines |
| Single rule baseline operations                               | System Database | Sql Vulnerability Assessment Rule Baselines          |
|                                                               |                 | Sql Vulnerability Assessment Rule Baseline           |
| Single scan results                                           | User Database   | Database Sql Vulnerability Assessment Scan Result    |
| Single scan results                                           | System Database | Sql Vulnerability Assessment Scan Result             |
| Scan details (summary)                                        | User Database   | Database Sql Vulnerability Assessment Scans          |
| Scan details (summary)                                        | System Database | Sql Vulnerability Assessment Scans                   |
| Execute manual scan                                           | User Database   | Database Sql Vulnerability Assessment Execute Scan   |
| Execute manual scan                                           | System Database | Sql Vulnerability Assessment Execute Scan            |
| VA settings (GET only is supported for Express Configuration) | User Database   | Database Sql Vulnerability Assessments Settings      |
| VA Settings operations                                        | Server          | Sql Vulnerability Assessments Settings               |
|                                                               |                 | Sql Vulnerability Assessments                        |

### Using Resource Manager templates

To configure vulnerability assessment baselines by using Azure Resource Manager templates, use the Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines type.

Ensure that you have enabled vulnerabilityAssessments before you add baselines.

Here's an example for defining Baseline Rule VA2065 to master database and VA1143 to user database as resources in a Resource Manager template:

```json

   "resources": [

      {

         "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",

         "apiVersion": "2018-06-01-preview",

         "name": "[concat(parameters('server_name'),'/', parameters('database_name') , '/default/VA2065/master')]",

         "properties": {

            "baselineResults": [

               {

                  "result": [

                     "FirewallRuleName3",

                     "StartIpAddress",

                     "EndIpAddress"

                  ]

               },

               {

                  "result": [

                     "FirewallRuleName4",

                     "62.92.15.68",

                     "62.92.15.68"

                  ]

               }

            ]

         },

         "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",

         "apiVersion": "2018-06-01-preview",

         "name": "[concat(parameters('server_name'),'/', parameters('database_name'), '/default/VA2130/Default')]",

         "dependsOn": [

            "[resourceId('Microsoft.Sql/servers/vulnerabilityAssessments', parameters('server_name'), 'Default')]"

         ],

         "properties": {

            "baselineResults": [

               {

                  "result": [

                     "dbo"

                  ]

               }

            ]

         }

      }

   ]
```

For master database and user database, the resource names are defined differently:

Master database - "name": "[concat(parameters('server_name'),'/', parameters('database_name') , '/default/VA2065/master')]",

User database - "name": "[concat(parameters('server_name'),'/', parameters('database_name') , '/default/VA2065/default')]",

To handle Boolean types as true/false, set the baseline result with binary input like "1"/"0".

```json

   {

      "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",

      "apiVersion": "2018-06-01-preview",

      "name": "[concat(parameters('server_name'),'/', parameters('database_name'), '/default/VA1143/Default')]",



      "dependsOn": [

         "[resourceId('Microsoft.Sql/servers/vulnerabilityAssessments', parameters('server_name'), 'Default')]"

      ],



      "properties": {

         "baselineResults": [

            {

               "result": [

                  "1"

               ]

            }

         ]

      }



   }
```

## FAQ

Q: What happens to the old scan results and baselines after I switch to express configuration?

A: Old results and baselines settings remain available on your storage account, but will not be used by the system anymore (or be updated). Once express configuration is enabled customers will not have direct access to this data (stored on internal Microsoft storage).

Q: Is there a way to get the classic weekly email report with express configuration?

A: The solution going forward will be using workflow automation / Logic Apps email scheduling which allows a set of abilties that are aligned with the greater Microsoft Defneder for Cloud experience:

Time based triggers

Scan based triggers

Support for disabled rules

Q: Why can’t I set database policies anymore?

A: The goal of SQL Vulnerability Assessment is to report all vulnerabilities and misconfigurations in a customer’s environment. selectively choosing which databases to scan misses that purpose.
It is important to mention that Defender for SQL is billed per server, so scanning only specific database has no effect on pricing.

Q: I want to go back to classic configuration. Is it possible?

A: Yes! Classic configuration is available using the existing REST APIs / Powershell cmdlets. If you reconfigure programitcally to classic configuration then that will be reflected in the UI together with a box suggesting you switch to express configuration.

Q: Will we see express configuration for other flavors of SQL?

A: Stay tuned for updates!

Q: Can I choose which experience will be the default?

A: No. Express configuration will be the default for every additional supported flavor of Azure SQL.



Troubleshooting

Switching back to the classic configuration experience:

Turn off the Defender for SQL Bundle from the UI and use powershell to reconfigure using the classic experience:

```powershell

Update-AzSqlServerAdvancedThreatProtectionSetting -ResourceGroupName " demo-rg" -ServerName " dbsrv1" -Enable true



Update-AzSqlServerVulnerabilityAssessmentSetting `

            -ResourceGroupName "demo-rg"`

            -ServerName "dbsrv1"`

            -StorageAccountName "mystorage" `

-RecurringScansInterval Weekly `

            -ScanResultsContainerName "vulnerability-assessment" `
```


“Vulnerability Assessment is enabled on this server or one of its underlying databases with an incompatible version” Error:

Switching to express configuration failed due to a server policy error:

This could be due to a transient operation – try switching again.

If the issue persists, try turning off the Microsoft Defender for SQL Bundle, hit Save, turn on the bundle and hit Save again.

Switching to express configuration failed due to a database policy error:

Database policies are not visible in the Azure Portal experience for Defender for SQL Vulnerability Assessment, so that’s why we check for them during the validation stage of switching to express configuration.

Disable all database policies under the relevant server and then try switching to express configuration again.

## Next steps

- Learn more about [Microsoft Defender for Azure SQL](defender-for-sql-introduction.md).
- Learn more about [data discovery and classification](/azure/azure-sql/database/data-discovery-and-classification-overview.md).
- Learn more about [Storing vulnerability assessment scan results in a storage account accessible behind firewalls and VNets](/azure/azure-sql/database/sql-database-vulnerability-assessment-storage.md).

---
title: Agentless vulnerability assessment for multicloud machines
description: Find software vulnerabilities and installed software on your Azure machines and AWS machines without installing an agent.
author: bmansheim
ms.author: benmansheim
ms.topic: how-to
ms.date: 09/19/2022
---
# Find vulnerabilities and collect software inventory with agentless scanning

Agentless scanning provides visibility into installed software and software vulnerabilities on your workloads with the Defender Vulnerability Management analysis engine. In addition to agent-based vulnerability scans with [Microsoft Defender for Endpoint](deploy-vulnerability-assessment-tvm.md) and [Qualys](deploy-vulnerability-assessment-vm.md), Microsoft Defender for Cloud provides agentless scanning to extend visibility and reach to more devices without the need to install an agent.

:::image type="content" source="media/deploy-vulnerability-assessment-agentless/agentless-vulnerability-assessment.png" alt-text="Diagram showing how agentless scanning works with vulnerability assessment.":::

If you already use one of the integrated vulnerability assessment agents, you can safely enable agentless scanning. In the event that the intended agent doesn't send the necessary data to Defender for Cloud, the agentless vulnerability assessment provides the data independent of the agent. When Defender for Cloud receives vulnerability findings from agent and agentless sources, Defender for Cloud shows the findings provided by an agent.

## Enabling agentless scanning for machines

When you enable Defender CSPM P1 or Defender for Servers P2 plan, agentless scanning is enabled on by default.

If you have Defender CSPM P1 or Defender for Servers P2 already enabled and agentless scanning is turned off, you need to turn on agentless scanning manually.

### Agentless vulnerability assessment on Azure

To enable agentless vulnerability assessment on Azure:

1. From Defender for Cloud's menu, open **Environment settings**.
1. Select the relevant subscription.
1. For either the CSPM P1 or Defender for Servers P2 plan, select **Settings**.

    :::image type="content" source="media/deploy-vulnerability-assessment-agentless/defender-plan-settings.png" alt-text="Screenshot of link for the settings of the Defender plans for Azure subscriptions." lightbox="media/deploy-vulnerability-assessment-agentless/defender-plan-settings.png":::

    When you enable agentless scanning on either plan, the setting applies to both plans.

1. In the settings pane, turn on **Agentless scanning for machines**.

    :::image type="content" source="media/deploy-vulnerability-assessment-agentless/agentless-scanning-off.png" alt-text="Screenshot of the agentless scanning status." lightbox="media/deploy-vulnerability-assessment-agentless/agentless-scanning-off.png":::

1. Select **Save**.

### Agentless vulnerability assessment on AWS

1. From Defender for Cloud's menu, open **Environment settings**.
1. Select the relevant subscription.
1. For either the CSPM P1 or Defender for Servers P2 plan, select **Settings**.

    :::image type="content" source="media/deploy-vulnerability-assessment-agentless/defender-plan-settings-aws.png" alt-text="Screenshot of link for the settings of the Defender plans for AWS accounts." lightbox="media/deploy-vulnerability-assessment-agentless/defender-plan-settings-aws.png":::

    When you enable agentless scanning on either plan, the setting applies to both plans.

1. In the settings pane, turn on **Agentless scanning for machines**.
 
    :::image type="content" source="media/deploy-vulnerability-assessment-agentless/agentless-scanning-off-aws.png" alt-text="Screenshot of the agentless scanning status for AWS accounts.":::

1. Select **Save and Next: Configure Access**.

1. Download the CloudFormation template.
    
1. Using the downloaded CloudFormation template, create the stack in AWS as instructed on screen. If you're onboarding a management account, you'll need to run the CloudFormation template both as Stack and as StackSet. Connectors will be created for the member accounts up to 24 hours after the onboarding.
    
1. Select **Next: Review and generate**.
    
1. Select **Update**.

## Exclude machines from scanning

Agentless scanning applies to all of the eligible machines in the subscription. To prevent specific machines from being scanned, exclude machines from agentless scanning based on your pre-existing environment tags. When Defender for Cloud performs the continuous discovery for machines, excluded machines are skipped.

To configure machines for exclusion:

1. From Defender for Cloud's menu, open **Environment settings**.
1. Select the relevant subscription.
1. For either the CSPM P1 or Defender for Servers P2 plan, select **Settings**.
1. For agentless scanning, select **Edit configuration**.

    :::image type="content" source="media/deploy-vulnerability-assessment-agentless/agentless-scanning-edit-configuration.png" alt-text="Screenshot of the link to edit the agentless scanning configuration.":::

1. Enter the tag name and value that applies to the machines that you want to exempt. You can enter multiple tag:value pairs.

    :::image type="content" source="media/deploy-vulnerability-assessment-agentless/agentless-scanning-exclude-tags.png" alt-text="Screenshot of the tag and value fields for excluding machines from agentless scanning.":::

1. Select **Save** to apply the changes.
